(function(e){e(document).ready(function(){function r(){e("#lockAt_value").val(e('input[id$="_lockAt"]')[0]["value"]+" "+e('input[id$="_lockAt"]')[1]["value"])}function o(e,t){this.group=e;this.user=t}function u(t){var n=e(this).parents("tr"),r=n.find(".group-user").val(),s=n.find(".group-id").val(),o=t.data.param1,u=-1;e.each(i,function(e){if(this.group===s&&this.user===r){u=e}});i.splice(u,1);n.remove();if(o.select2("open")){o.select2("close")}else{o.select2("close");o.select2("open")}}e(document).foundation();e("#LoginForm_email").focus();e(".js_show").toggle();e(".js_hide").toggle();e("#language-selector").parent().clone().appendTo(e(".top-bar .left"));e(document).keyup(function(t){if(t.keyCode===27){e(".ul-nav-toggle").click()}});e(".sticky").append(e("<i/>",{"class":"fi-eye ul-nav-toggle",text:" Menu"}));e(".ul-nav li").click(function(){if(e(this).find("#language-selector").length===0){window.location=e(this).find("a").attr("href")}});e(".ul-nav-toggle").click(function(){var t=e(this);t.siblings("ul").toggleClass("ul-nav ul-nav-hide")}).click();e("#teacher-ac").on("autocompleteselect",function(e,t){e.preventDefault();window.location.href="index.php?r=Appointment/makeAppointment&teacher="+t.item.value});e("#teacher-ac").on("autocompletefocus",function(e){e.preventDefault()});e(".avaiable").css("cursor","pointer");e(".appointment-create-table .avaiable").click(function(){var t=e(this);e("#form_date").val(t.parents("table").data("date"));e("#form_time").val(t.siblings().text().trim());e('select[name*="dateAndTime_id"]').select2("val",t.data("id"))});e(".delete-children").click(function(){if(!confirm("Wenn Sie dieses Kind löschen werden auch alle Termine des Kindes gelöscht.")){return false}});e(".delete-appointment").click(function(){if(!confirm("Termin wirklich löschen?")){return false}});e(".infolabel").each(function(){e(this).append(e("<i/>",{"class":"fi-info"}))});e(".infofeld").click(function(t){t.preventDefault();e(".infobox").show();e(".infobox").children("p").html(e(this).siblings(".infotext").html());e(".infobox").css("left",e(document).width()/2-200);e(".infobox").css("top",e(window).height()/4);t.stopPropagation();e(document).one("click",function(){e(".infobox").hide()})});e("#CsvUpload_file").on("change",function(){if(this.files[0].size>maxFileSize){alert(errorMessage);e(this).val("")}else{e("#file-input-name").val(this.files[0].name)}});if(e("#lockAt_value").val()!==""&&typeof e("#lockAt_value").val()==="string"){var t=e("#lockAt_value").val(),n=t.split(" ");e("#date_lockAt").val(n[0]);e("#time_lockAt").val(n[1])}e("#User_role").on("change",function(t){if(t.val>1){e("#groups-select").select2("enable",true)}else{e("#groups-select").select2("enable",false);e("#groups-select").select2("val","")}});e('select[id$="_allowBlockingAppointments"], select[id$="_banUsers"], select[id$="_mailsActivated"]').on("change",function(t){var n=t.target["value"]==="0"?true:false;e(t.target).parents("fieldset").children(".row:gt(0)").children(".small-4").children("input, select").attr("disabled",n)});e('select[id$="_randomTeacherPassword"]').on("change",function(t){var n=t.target["value"]==="0"?false:true;e('input[id$="_defaultTeacherPassword"]').attr("disabled",n)});e('input[id$="_dateFormat"], input[id$="_timeFormat"]').on("change",function(){e("#ConfigForm_dateTimeFormat").val(e('input[id$="_dateFormat"]').val()+" "+e('input[id$="_timeFormat"]').val())});e('input[id$="_lockAt"]').on({change:function(){r()},keyup:function(){r()}});e('input[id$="_display"]').on("autocompletefocus",function(e){e.preventDefault()});e('input[id$="_teacher"]').on("autocompletefocus",function(e){e.preventDefault()});e("#appointment_parent").on("autocompletefocus",function(e){e.preventDefault()});e("#print-view-teacher").on("autocompletefocus",function(e){e.preventDefault()});e('input[id$="_display"]').on("autocompleteselect",function(t,n){t.preventDefault();e(this).val(n.item.label);e(this).nextAll("input").val(n.item.value)});e("#appointment_teacher").on("autocompleteselect",function(t,n){t.preventDefault();e(this).val(n.item.label);e(this).nextAll("input").val(n.item.value);e.get("index.php/?r=appointment/getteacherappointmentsajax",{teacherId:n.item.value,classname:"Appointment"},function(t){e("#appointment_dateAndTime_select").html(t);e("#appointment_dateAndTime_select").children("select").select2()},"json")});e("#appointmentBlock_teacher").on("autocompleteselect",function(t,n){t.preventDefault();e(this).val(n.item.label);e(this).nextAll("input").val(n.item.value);e.get("index.php/?r=appointment/getteacherappointmentsajax",{teacherId:n.item.value,classname:"BlockedAppointment"},function(t){e("#appointment_dateAndTime_select").html(t);e("#appointment_dateAndTime_select").children("select").select2()},"json")});e("#appointment_parent").on("autocompleteselect",function(t,n){t.preventDefault();e(this).val(n.item.label);e.get("index.php/?r=appointment/getselectchildrenajax",{id:n.item.value},function(t){e("#appointment_parent_select").html(t);e("#appointment_parent_select").children("select").select2()},"json")});e("#print-view-teacher").on("autocompleteselect",function(t,n){t.preventDefault();e(this).val(n.item.label);e(this).data("id",n.item.value)});e("#print-view-button").click(function(){var t=e("#print-view-date").val();var n=e("#print-view-teacher").data("id");if(t!==""&&typeof t==="string"&&n!==""&&typeof n==="string"){window.location.href="index.php?r=appointment/overview&id="+n+"&date="+t}});e("#print-view-all-button").click(function(){var t=e("#print-view-date").val();var n=e("#show-empty-plans").is(":checked")?1:0;if(t!==""&&typeof t==="string"){window.location.href="index.php?r=appointment/generatePlans&date="+t+"&emptyPlans="+n}});var i=[],s=0;e.each(e("#date-form table #input-target").children(),function(){var t=e(this).find(".group-user").val(),n=e(this).find(".group-id").val(),r=new o(n,t);i.push(r);s++});e("#group-users").on("select2-selecting",function(t){var n=e("#groups"),r=n.val(),a=new o(r,t.val),f=false;e.each(i,function(){if(this.group===a.group&&this.user===a.user){f=true}});if(!f){var l=e(this),c=e("<td/>").text(e(this).find("option[value="+t.val+"]").text()),h=e("<td/>").text(n.select2("data").text),p=e("#input-template"),d=p.find(".group-user").clone().attr("name","user["+s+"]").val(a.user),v=p.find(".group-id").clone().attr("name","group["+s+"]").val(a.group),m=p.find(".group-delete").clone().attr("name","group["+s+"]"),g=p.find("i").clone().click({param1:l},u);c.append(d);h.append(v).append(m);e("<tr/>").append(c).append(h).append(e("<td/>",{"class":"text-center"}).append(g)).appendTo(e("#input-target"));i.push(a);s++}event.preventDefault();t.preventDefault();l.select2("close");l.select2("open")});e("#close-user-select").on("click",function(){e("#group-users").select2("close")});e(".flag-relation-for-delete").click(function(){var t=e(this).parents("tr");t.find(".group-delete").click();t.toggleClass("delete-assign")})});var t=0;e(".add-child-tan").click(function(){t++;var n=e(".customChild:first").clone();e(n).children().each(function(){var n=e(this).find("input"),r=false;if(n.hasClass("select2-focusser")){n=e(this).find("select");r=true}if(n.length!==0){e(n).attr("name",e(n).attr("name").replace(/\d/,t));e(n).attr("id",e(n).attr("id").replace(/\d/,t));e(n).val("")}if(r){e(n).attr("tabindex","");e(n).attr("class","");e(this).children(".small-9").html(n)}});e(".customChild:last").after(e(n));e(n).find("select").select2()})})(jQuery)